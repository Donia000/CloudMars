<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Payment - OnlyPay</title>
    <style>
        :root {
            --dark-blue: #0a0e23;
            --darker-blue: #060917;
            --dark-purple: #1e2356;
            --darker-purple: #2a1a4a;
            --orange: #ff7b25;
            --orange-light: #ff9a56;
            --text-light: #ffffff;
            --text-muted: #b8c1e1;
            --text-dim: #7d8db8;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--dark-blue);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .checkout-container {
            width: 100%;
            max-width: 600px;
            background-color: var(--darker-blue);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
            position: relative;
        }

        .header {
            color: var(--orange);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            letter-spacing: 0.5px;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 12px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--dark-purple);
            z-index: 1;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            color: var(--text-dim);
            cursor: pointer;
        }
        
        .step.active {
            color: var(--text-light);
        }
        
        .step.completed {
            color: var(--orange);
        }
        
        .step-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--dark-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .active .step-marker {
            background-color: var(--orange);
        }
        
        .completed .step-marker {
            background-color: var(--orange);
        }
        
        .completed .step-marker::after {
            content: '✓';
        }
        
        .divider {
            border-top: 1px solid var(--dark-purple);
            margin: 25px 0;
            opacity: 0.5;
        }
        
        .form-section {
            display: none;
            animation: fadeIn 0.5s ease forwards;
        }
        
        .form-section.active {
            display: block;
        }
        
        .section-title {
            color: var(--orange);
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 24px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--dark-purple);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--orange);
            box-shadow: 0 0 0 2px rgba(255, 123, 37, 0.2);
            background-color: rgba(255, 255, 255, 0.08);
        }
        
        .form-control.error {
            border-color: red;
            box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.2);
        }
        
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23b8c1e1'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 15px;
        }
        
        .error-message {
            color: red;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .order-summary {
            background: linear-gradient(135deg, var(--dark-purple) 0%, var(--darker-purple) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .order-summary h4 {
            color: var(--orange);
            font-size: 16px;
            margin-top: 15px;
            margin-bottom: 10px;
        }
        
        .order-summary p {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .edit-link {
            color: var(--orange);
            font-size: 12px;
            text-decoration: none;
            margin-left: 10px;
        }
        
        .edit-link:hover {
            text-decoration: underline;
        }
        
        .course-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .course-item:last-child {
            border-bottom: none;
        }
        
        .course-name {
            font-weight: 600;
        }
        
        .course-price {
            color: var(--orange);
            font-weight: 600;
        }
        
        .total-amount {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .card-section {
            background: linear-gradient(135deg, var(--dark-purple) 0%, var(--darker-purple) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .card-title {
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--orange);
            display: flex;
            align-items: center;
        }
        
        .card-title img {
            margin-right: 10px;
            height: 24px;
        }
        
        .card-number {
            font-size: 18px;
            letter-spacing: 1px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: space-between;
        }
        
        .card-details {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .card-detail-group {
            display: flex;
            flex-direction: column;
        }
        
        .card-detail-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
            opacity: 0.7;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-secondary {
            background-color: var(--dark-purple);
            color: var(--text-light);
        }
        
        .btn-secondary:hover {
            background-color: var(--darker-purple);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--orange) 0%, var(--orange-light) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 123, 37, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 123, 37, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .card-icons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .card-icon {
            width: 40px;
            height: 25px;
            object-fit: contain;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        
        .card-icon.active {
            opacity: 1;
        }
        
        .course-selection {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
        }

        .course-option {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .course-option:last-child {
            margin-bottom: 0;
        }

        .course-option input[type="checkbox"] {
            margin-right: 10px;
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--dark-purple);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }

        .course-option input[type="checkbox"]:checked {
            background-color: var(--orange);
            border-color: var(--orange);
        }

        .course-option input[type="checkbox"]:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
        }

        .course-option label {
            cursor: pointer;
        }
        
        .success-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .success-message.active {
            display: flex;
        }

        .success-message > div {
            background-color: var(--darker-blue);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .success-icon i {
            color: #4CAF50;
            font-size: 48px;
            margin-bottom: 20px;
        }

        .success-text {
            color: var(--text-light);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .redirect-message {
            color: var(--text-muted);
            font-size: 16px;
            margin-bottom: 25px;
        }

        .course-redirect-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--orange) 0%, var(--orange-light) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .course-redirect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 123, 37, 0.4);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 480px) {
            .checkout-container {
                padding: 20px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .nav-buttons {
                flex-direction: column-reverse;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }

            .success-message > div {
                padding: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="checkout-container">
        <div class="header">Payment</div>
        
        <div class="progress-steps">
            <div class="step completed" data-step="1">
                <div class="step-marker">1</div>
                <div>Student info</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-marker">2</div>
                <div>Shipping info</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-marker">3</div>
                <div>Payment</div>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="form-section active" id="customer-info">
            <div class="section-title">
                <i class="fas fa-user"></i> Customer Information
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="first-name" class="form-label">First Name</label>
                    <input type="text" id="first-name" class="form-control" placeholder="John" required>
                    <div class="error-message" id="first-name-error"></div>
                </div>
                <div class="form-group">
                    <label for="last-name" class="form-label">Last Name</label>
                    <input type="text" id="last-name" class="form-control" placeholder="Smith" required>
                    <div class="error-message" id="last-name-error"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="email" class="form-label">Email Address</label>
                <input type="email" id="email" class="form-control" placeholder="john.smith@example.com" required>
                <div class="error-message" id="email-error"></div>
            </div>
            
            <div class="form-group">
                <label for="phone" class="form-label">Phone Number</label>
                <input type="tel" id="phone" class="form-control" placeholder="+1 (555) 123-4567" required>
                <div class="error-message" id="phone-error"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Select Courses</label>
                <div class="course-selection">
                    <div class="course-option">
                        <input type="checkbox" id="course-fullstack" name="courses" value="Full Stack Web Development" data-price="999.00">
                        <label for="course-fullstack">Full Stack Web Development - $999.00</label>
                    </div>
                    <div class="course-option">
                        <input type="checkbox" id="course-ml" name="courses" value="AI & Machine Learning Engineer" data-price="1499.00">
                        <label for="course-ml">AI & Machine Learning Engineer - $1499.00</label>
                    </div>
                    <div class="course-option">
                        <input type="checkbox" id="course-ds" name="courses" value="Data Science Professional" data-price="1299.00">
                        <label for="course-ds">Data Science Professional - $1299.00</label>
                    </div>
                </div>
                <div class="error-message" id="courses-error"></div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn btn-primary" id="next-to-shipping">Continue to Shipping</button>
            </div>
        </div>
        
        <div class="form-section" id="shipping-info">
            <div class="section-title">
                <i class="fas fa-truck"></i> Shipping Information
            </div>
            
            <div class="form-group">
                <label for="address" class="form-label">Street Address</label>
                <input type="text" id="address" class="form-control" placeholder="123 Main St" required>
                <div class="error-message" id="address-error"></div>
            </div>
            
            <div class="form-group">
                <label for="address2" class="form-label">Apt, Suite, etc. (Optional)</label>
                    <input type="text" id="address2" class="form-control" placeholder="Apt 4B">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="country" class="form-label">Country</label>
                    <select id="country" class="form-control" required>
                        <option value="" disabled selected>Select Country</option>
                        <option value="US">United States</option>
                        <option value="UK">United Kingdom</option>
                        <option value="CA">Canada</option>
                        <option value="AU">Australia</option>
                        <option value="DE">Germany</option>
                        <option value="EG">Egypt</option>
                        <option value="SP">Spain</option>
                        <option value="IT">Italy</option>
                        <option value="JO">Jordan</option>
                        <option value="FR">France</option>
                        <option value="RU">Russia</option>
                        <option value="BR">Brazil</option>
                        <option value="CH">China</option>
                        <option value="FI">Finland</option>
                        <option value="CR">Croatia</option>
                    </select>
                    <div class="error-message" id="country-error"></div>
                </div>
                <div class="form-group">
                    <label for="state" class="form-label">State/Province</label>
                    <input type="text" id="state" class="form-control" required>
                    <div class="error-message" id="state-error"></div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="city" class="form-label">City</label>
                    <input type="text" id="city" class="form-control" required>
                    <div class="error-message" id="city-error"></div>
                </div>
                <div class="form-group">
                    <label for="zip" class="form-label">ZIP/Postal Code</label>
                    <input type="text" id="zip" class="form-control" required>
                    <div class="error-message" id="zip-error"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="shipping-method" class="form-label">Shipping Method</label>
                <select id="shipping-method" class="form-control" required>
                    <option value="" disabled selected>Select Shipping Method</option>
                    <option value="standard">Standard Shipping (Free)</option>
                    <option value="express">Express Shipping ($9.99)</option>
                    <option value="priority">Priority Shipping ($19.99)</option>
                </select>
                <div class="error-message" id="shipping-method-error"></div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" id="back-to-customer">Back</button>
                <button class="btn btn-primary" id="next-to-payment">Continue to Payment</button>
            </div>
        </div>
        
        <div class="form-section" id="payment-section">
            <div class="section-title">
                <i class="fas fa-credit-card"></i> Payment Method
            </div>
            
            <div class="order-summary">
                <div class="section-title" style="margin-bottom: 15px; font-size: 18px;">
                    <i class="fas fa-shopping-cart"></i> Order Summary
                </div>
                <div id="customer-summary"></div>
                <div id="shipping-summary"></div>
                <div id="courses-summary"></div>
                <div class="total-amount">
                    <div>Total:</div>
                    <div id="total-price">$0.00</div>
                </div>
            </div>
            
            <div class="card-section">
                <div class="card-title">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="VISA">
                    Credit/Debit Card
                </div>
                <div class="card-number">
                    <span id="card-display">•••• •••• •••• ••••</span>
                    <span id="card-type"></span>
                </div>
                <div class="card-details">
                    <div class="card-detail-group">
                        <div class="card-detail-label">Cardholder Name</div>
                        <div id="cardholder-display">FULL NAME</div>
                    </div>
                    <div class="card-detail-group">
                        <div class="card-detail-label">Expires</div>
                        <div id="expiry-display">MM/YY</div>
                    </div>
                    <div class="card-detail-group">
                        <div class="card-detail-label">CVV</div>
                        <div>•••</div>
                    </div>
                </div>
            </div>
            
            <form id="payment-form">
                <div class="form-group">
                    <label for="cardholder" class="form-label">Cardholder Name</label>
                    <input type="text" id="cardholder" class="form-control" placeholder="John Smith" required>
                    <div class="error-message" id="cardholder-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="cardnumber" class="form-label">Card Number</label>
                    <input type="text" id="cardnumber" class="form-control" placeholder="4242 4242 4242 4242" required maxlength="19">
                    <div class="error-message" id="cardnumber-error"></div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="expiry-month" class="form-label">Expiry Month</label>
                        <select id="expiry-month" class="form-control" required>
                            <option value="" disabled selected>MM</option>
                            <option value="01">01</option>
                            <option value="02">02</option>
                            <option value="03">03</option>
                            <option value="04">04</option>
                            <option value="05">05</option>
                            <option value="06">06</option>
                            <option value="07">07</option>
                            <option value="08">08</option>
                            <option value="09">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                        <div class="error-message" id="expiry-month-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="expiry-year" class="form-label">Expiry Year</label>
                        <select id="expiry-year" class="form-control" required>
                            <option value="" disabled selected>YY</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                        </select>
                        <div class="error-message" id="expiry-year-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cvv" class="form-label">CVV</label>
                        <input type="text" id="cvv" class="form-control" placeholder="•••" required maxlength="4">
                        <div class="error-message" id="cvv-error"></div>
                    </div>
                </div>
                
                <div class="card-icons">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa" class="card-icon" id="visa-icon">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" class="card-icon" id="mastercard-icon">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/American_Express_logo_%282018%29.svg" alt="Amex" class="card-icon" id="amex-icon">
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <input type="checkbox" id="terms" class="form-control" style="width: auto; display: inline-block;" required>
                    <label for="terms" style="display: inline-block; margin-left: 10px;">I agree to the terms and conditions</label>
                    <div class="error-message" id="terms-error"></div>
                </div>
            </form>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" id="back-to-shipping">Back</button>
                <button class="btn btn-primary" id="complete-payment">Complete Payment</button>
            </div>
        </div>

        <div class="success-message" id="success-message">
            <div>
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="success-text">Payment Successful!</div>
                <div class="redirect-message" id="redirect-message">
                    You will be redirected to your profile shortly...
                </div>
                <button class="course-redirect-btn" id="course-redirect-btn">
                    Go to Profile Now
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { auth, onAuthStateChanged, enrollCourse } from './firebaseAuth.js';

        document.addEventListener('DOMContentLoaded', function() {
            const steps = document.querySelectorAll('.step');
            const sections = {
                1: document.getElementById('customer-info'),
                2: document.getElementById('shipping-info'),
                3: document.getElementById('payment-section')
            };
            
            const nextToShippingBtn = document.getElementById('next-to-shipping');
            const backToCustomerBtn = document.getElementById('back-to-customer');
            const nextToPaymentBtn = document.getElementById('next-to-payment');
            const backToShippingBtn = document.getElementById('back-to-shipping');
            const completePaymentBtn = document.getElementById('complete-payment');
            
            const successMessage = document.getElementById('success-message');
            const courseRedirectBtn = document.getElementById('course-redirect-btn');
            
            const paymentForm = document.getElementById('payment-form');
            const cardholderInput = document.getElementById('cardholder');
            const cardNumberInput = document.getElementById('cardnumber');
            const expiryMonthInput = document.getElementById('expiry-month');
            const expiryYearInput = document.getElementById('expiry-year');
            const cvvInput = document.getElementById('cvv');
            
            const cardDisplay = document.getElementById('card-display');
            const cardholderDisplay = document.getElementById('cardholder-display');
            const expiryDisplay = document.getElementById('expiry-display');
            const cardTypeDisplay = document.getElementById('card-type');
            
            const visaIcon = document.getElementById('visa-icon');
            const mastercardIcon = document.getElementById('mastercard-icon');
            const amexIcon = document.getElementById('amex-icon');
            
            const courseCheckboxes = document.querySelectorAll('input[name="courses"]');
            let selectedCourses = [];
            let userId = null;

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    window.location.href = "login.html";
                }
            });

            navigateToStep(1);

            steps.forEach(step => {
                step.addEventListener('click', function() {
                    const stepNumber = parseInt(this.getAttribute('data-step'));
                    if (this.classList.contains('completed') || this.classList.contains('active')) {
                        navigateToStep(stepNumber);
                    }
                });
            });

            function navigateToStep(stepNumber) {
                Object.values(sections).forEach(section => {
                    section.classList.remove('active');
                });

                steps.forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index + 1 < stepNumber) {
                        step.classList.add('completed');
                    } else if (index + 1 === stepNumber) {
                        step.classList.add('active');
                    }
                });

                sections[stepNumber].classList.add('active');

                if (stepNumber === 3) {
                    renderSummary();
                }
            }

            nextToShippingBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (validateCustomerInfo()) {
                    navigateToStep(2);
                }
            });

            backToCustomerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                navigateToStep(1);
            });

            nextToPaymentBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (validateShippingInfo()) {
                    navigateToStep(3);
                }
            });

            backToShippingBtn.addEventListener('click', function(e) {
                e.preventDefault();
                navigateToStep(2);
            });

            completePaymentBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (validatePaymentInfo()) {
                    processPayment();
                }
            });

            courseRedirectBtn.addEventListener('click', function() {
                window.location.href = 'profile.html';
            });

            function validateCustomerInfo() {
                let errors = [];
                const firstName = document.getElementById('first-name').value.trim();
                const lastName = document.getElementById('last-name').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();

                if (!firstName) errors.push({ field: 'first-name', message: 'First name is required' });
                if (!lastName) errors.push({ field: 'last-name', message: 'Last name is required' });
                if (!email) errors.push({ field: 'email', message: 'Email is required' });
                else if (!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)) errors.push({ field: 'email', message: 'Please enter a valid email address' });
                if (!phone) errors.push({ field: 'phone', message: 'Phone number is required' });
                if (selectedCourses.length === 0) errors.push({ field: 'courses', message: 'Please select at least one course' });

                if (errors.length > 0) {
                    displayErrors(errors);
                    return false;
                }
                clearErrors();
                return true;
            }

            function validateShippingInfo() {
                let errors = [];
                const address = document.getElementById('address').value.trim();
                const country = document.getElementById('country').value;
                const state = document.getElementById('state').value.trim();
                const city = document.getElementById('city').value.trim();
                const zip = document.getElementById('zip').value.trim();
                const shippingMethod = document.getElementById('shipping-method').value;

                if (!address) errors.push({ field: 'address', message: 'Street address is required' });
                if (!country) errors.push({ field: 'country', message: 'Country is required' });
                if (!state) errors.push({ field: 'state', message: 'State/Province is required' });
                if (!city) errors.push({ field: 'city', message: 'City is required' });
                if (!zip) errors.push({ field: 'zip', message: 'ZIP/Postal code is required' });
                if (!shippingMethod) errors.push({ field: 'shipping-method', message: 'Shipping method is required' });

                if (errors.length > 0) {
                    displayErrors(errors);
                    return false;
                }
                clearErrors();
                return true;
            }

            function validatePaymentInfo() {
                let errors = [];
                const cardholder = cardholderInput.value.trim();
                const cardNumber = cardNumberInput.value.replace(/\s/g, '');
                const expiryMonth = expiryMonthInput.value;
                const expiryYear = expiryYearInput.value;
                const cvv = cvvInput.value.trim();
                const terms = document.getElementById('terms').checked;

                if (!cardholder) errors.push({ field: 'cardholder', message: 'Cardholder name is required' });
                if (!cardNumber) errors.push({ field: 'cardnumber', message: 'Card number is required' });
                else if (cardNumber.length < 16) errors.push({ field: 'cardnumber', message: 'Please enter a valid 16-digit card number' });
                if (!expiryMonth) errors.push({ field: 'expiry-month', message: 'Expiry month is required' });
                if (!expiryYear) errors.push({ field: 'expiry-year', message: 'Expiry year is required' });
                if (!cvv) errors.push({ field: 'cvv', message: 'CVV is required' });
                else if (cvv.length < 3) errors.push({ field: 'cvv', message: 'Please enter a valid CVV code' });
                if (!terms) errors.push({ field: 'terms', message: 'You must agree to the terms and conditions' });

                if (errors.length > 0) {
                    displayErrors(errors);
                    return false;
                }
                clearErrors();
                return true;
            }

            function displayErrors(errors) {
                errors.forEach(error => {
                    const errorElement = document.getElementById(`${error.field}-error`);
                    const inputElement = document.getElementById(error.field);
                    if (errorElement) errorElement.textContent = error.message;
                    if (inputElement) inputElement.classList.add('error');
                });
            }

            function clearErrors() {
                const errorElements = document.querySelectorAll('.error-message');
                errorElements.forEach(el => el.textContent = '');
                const inputElements = document.querySelectorAll('.form-control.error');
                inputElements.forEach(el => el.classList.remove('error'));
            }

            async function processPayment() {
                completePaymentBtn.disabled = true;
                completePaymentBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> PROCESSING...';

                try {
                    for (const course of selectedCourses) {
                        const courseId = course.name.replace(/\s+/g, '-').toLowerCase();
                        await enrollCourse(userId, courseId, course.name);
                    }

                    completePaymentBtn.innerHTML = '<i class="fas fa-check"></i> PAYMENT SUCCESSFUL!';
                    completePaymentBtn.style.background = 'linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%)';
                    successMessage.classList.add('active');

                    setTimeout(() => {
                        window.location.href = 'profile.html';
                    }, 5000);
                } catch (error) {
                    console.error('Error enrolling courses:', error);
                    completePaymentBtn.innerHTML = 'Complete Payment';
                    completePaymentBtn.disabled = false;
                    alert('Failed to enroll courses. Please try again.');
                }
            }

            cardholderInput.addEventListener('input', function(e) {
                cardholderDisplay.textContent = e.target.value || 'FULL NAME';
            });

            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
                e.target.value = value;

                if (value.trim() === '') {
                    cardDisplay.textContent = '•••• •••• •••• ••••';
                } else {
                    const parts = value.split(' ');
                    let display = parts[0] || '';
                    for (let i = 1; i < parts.length; i++) {
                        display += ' ' + (i < parts.length - 1 ? '••••' : parts[i]);
                    }
                    if (value.length % 5 === 0 && value.length < 19 && value.length > 0) {
                        display += ' ••••';
                    }
                    cardDisplay.textContent = display;
                }

                detectCardType(value);
            });

            expiryMonthInput.addEventListener('change', updateExpiryDisplay);
            expiryYearInput.addEventListener('change', updateExpiryDisplay);

            function updateExpiryDisplay() {
                const month = expiryMonthInput.value || 'MM';
                const year = expiryYearInput.value || 'YY';
                expiryDisplay.textContent = `${month}/${year}`;
            }

            cvvInput.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '');
            });

            cvvInput.addEventListener('focus', function() {
                document.querySelector('.card-section').style.transform = 'rotateY(180deg)';
            });

            cvvInput.addEventListener('blur', function() {
                document.querySelector('.card-section').style.transform = 'rotateY(0deg)';
            });

            function detectCardType(cardNumber) {
                visaIcon.classList.remove('active');
                mastercardIcon.classList.remove('active');
                amexIcon.classList.remove('active');
                cardTypeDisplay.innerHTML = '';

                const cleanNumber = cardNumber.replace(/\s/g, '');
                if (/^4/.test(cleanNumber)) {
                    visaIcon.classList.add('active');
                    cardTypeDisplay.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa" style="height:20px;">';
                } else if (/^5[1-5]/.test(cleanNumber)) {
                    mastercardIcon.classList.add('active');
                    cardTypeDisplay.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" style="height:20px;">';
                } else if (/^3[47]/.test(cleanNumber)) {
                    amexIcon.classList.add('active');
                    cardTypeDisplay.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/American_Express_logo_%282018%29.svg" alt="Amex" style="height:20px;">';
                }
            }

            courseCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedCourses);
            });

            function updateSelectedCourses() {
                selectedCourses = [];
                let total = 0;

                courseCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const course = {
                            name: checkbox.value,
                            price: parseFloat(checkbox.dataset.price)
                        };
                        selectedCourses.push(course);
                        total += course.price;
                    }
                });

                if (sections[3].classList.contains('active')) {
                    renderSummary();
                }
            }

            function renderSummary() {
                const firstName = document.getElementById('first-name').value;
                const lastName = document.getElementById('last-name').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                document.getElementById('customer-summary').innerHTML = `
                    <h4>Customer Information <a href="#" class="edit-link" onclick="navigateToStep(1); return false;">Edit</a></h4>
                    <p>${firstName} ${lastName}</p>
                    <p>${email}</p>
                    <p>${phone}</p>
                `;

                const address = document.getElementById('address').value;
                const address2 = document.getElementById('address2').value;
                const country = document.getElementById('country').options[document.getElementById('country').selectedIndex].text;
                const state = document.getElementById('state').value;
                const city = document.getElementById('city').value;
                const zip = document.getElementById('zip').value;
                const shippingMethod = document.getElementById('shipping-method').options[document.getElementById('shipping-method').selectedIndex].text;
                document.getElementById('shipping-summary').innerHTML = `
                    <h4>Shipping Information <a href="#" class="edit-link" onclick="navigateToStep(2); return false;">Edit</a></h4>
                    <p>${address}${address2 ? ', ' + address2 : ''}</p>
                    <p>${city}, ${state} ${zip}</p>
                    <p>${country}</p>
                    <p>Shipping Method: ${shippingMethod}</p>
                `;

                const coursesSummary = document.getElementById('courses-summary');
                coursesSummary.innerHTML = '';
                if (selectedCourses.length === 0) {
                    coursesSummary.innerHTML = '<div class="course-item">No courses selected</div>';
                } else {
                    selectedCourses.forEach(course => {
                        const courseItem = document.createElement('div');
                        courseItem.className = 'course-item';
                        courseItem.innerHTML = `
                            <div class="course-name">${course.name}</div>
                            <div class="course-price">$${course.price.toFixed(2)}</div>
                        `;
                        coursesSummary.appendChild(courseItem);
                    });
                }

                const total = selectedCourses.reduce((sum, course) => sum + course.price, 0);
                document.getElementById('total-price').textContent = `$${total.toFixed(2)}`;
            }
        });
    </script>
</body>
</html>